<!DOCTYPE html>
<html>
  <head>
    <title>In Browser Tiny Tina Wonderland's Save Editor</title>
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://abramhindle.github.io/ttwl-cli-saveedit/" />
    <meta property="og:title" content="In Browser Tiny Tina Wonderland's Save Editor, duplicate save files, fake TVHM, import items" />
    <meta name="google-site-verification" content="ZA9MJWLGd8uurbI8EZT-Bc7ngYjOre39-m40xCIg5ro" />
    <script src="https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js"></script>
    <style>
      .disabled {
          pointer-events: none;
          opacity: 0.4;
      }
      #status {
          background-color: yellow;
      }
      p, ul, ol {
          margin: 1em;
          min-width: 10em;
          width: 50vh;
          padding: 0.25em;
      }
      h1, h2, h3 {
          padding: 0.25em ;
      }
      .smaller {
          font-size: x-small;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Online In Browser Tiny Tina Wonderland's Save Editor</h1>
      <p>
        Do you want to modify Tiny Tina Wonderland's Saves, Tiny Tina
        Wonderland's Savefiles, or Tiny Tina Wonderland's Save Games?
        This is tech demo about running Python code in the browser,
        but you may use it to the modify the savefiles in Tiny Tina's
        Wonderlands. This was working as of TTWL v1.0.4.0a (2022-06-23).
      </p>
      <p>
        Using <a href="https://pyodide.org/en/stable/">Pyodide</a> I managed to host the python commandline program <a href="https://github.com/abramhindle/ttwl-cli-saveedit/">ttwl-cli-saveedit</a> on the web! So this means python is running in your browser. If you want to run it at home just run on a Linux or OSX computer:
        <code>
          <pre>
            pip3 install --user git+https://github.com/abramhindle/ttwl-cli-saveedit
          </pre>
        </code>
      <p>
        More documentation for the commandline program is here: <a href="https://github.com/abramhindle/ttwl-cli-saveedit/">ttwl-cli-saveedit</a>
      </p>
      </p>
      <h3>ttwl-cli-saveedit in your browser</h3>
      <p>
        This webpage provides a user interface for you to modify your Tiny Tina's Wonderlands (TTWL) save files.
        What can this save editor do?
      </p>
      <ul>
        <li> Allow you to duplicate your savefile (change/randomize your GUID). The game cannot see multiple savefiles if they have the same GUID.
        <li> Unfinish all your missions. Do you want to play the game again as your current character? Then click `Unfinish Your Missions` and play the whole game again.
        <li> Do you want the BL3 TVHM experience in TTWL? Well use
        fake TVHM with Chaos Level. Replay the whole story (minus the
        last boss) at your Chaos level and current level. Want to
        primordial mission rewards? I'm not sure that's possible but
          why don't you try it.
        <li> Or do you want to import items from another savefile? Get their balance code and paste them into the item import box and give it a go!
      </ul>
      <h3>Instructions:</h3>
      <ol>
        <li> First load the example file or "upload" your save file. This program will not send your savefiles anywhere, they will be locally manipulated in your browser. The details of the file will be printed below.
        <li> Second, manipulate your savefile. Every button will send you a new savefile that you can download.
        <li> Copy your savefile into your TTWL save game directory or folder and rename to a number dot sav (like "100.sav" or "111.sav").
      </ol>
      <h3>No support provided:</h3>
      <p class="smaller">
        Here's where I come off as a jerk:
        I will listen to actual coherent
        bug
        reports <a href="https://github.com/abramhindle/ttwl-cli-saveedit/issues">here</a>. I am not very interested in feature requests. This is a technology demo.
        I will gladly accept pull requests. If you want something, then make it better, it is opensource, I just wanted to deploy python in the browser. Don't contact me about windows issues, or mac issues, or ask me where savefiles are stored. I don't know these things and I don't have any answers.
      </p>
    </div>
    <div id="status">Loading</div>
    <div id="ui">
      <button id="example" onclick="loadExample()">Load Example</button> or upload your own:
      <input name="upload" id="upload" type="file"><br>
      <button class="needFile" id="downloadInput" onclick="downloadInputFile()">Download Inputfile</button>
      <button class="needFile" id="dupeFile" onclick="randomizeGUID()">Duplicate your Savefile</button>
      <button class="needFile" id="unfinish" onclick="unfinishMissions()">Unfinish Your Missions</button>
      <button class="needFile" id="tvhm" onclick="fakeTVHM()">Fake TVHM with Chaos Level</button><br>
      <button class="needFile" id="tvhm" onclick="chaotic()">Make all gear Chaotic</button>
      <button class="needFile" id="tvhm" onclick="volatile()">Make all gear Volatile</button><br>
      <div>
        <h3>Item import</h3>
        Try items like: Balance_M_Sword2H_BansheeClaw_Leg (level 40, mayhem unknown): BL3(BQAAAADCvYA7Cxphg0La6XWPTqQjCAAJAQ==)<br>
        <textarea cols="80" id="inventory"></textarea></br>
        <button class="needFile" id="import" onclick="importInventory()">Import Inventory Items</button>
      </div>
    </div>
    <div>
          <code>
            <pre id="output">
            </pre>
          </code>
      <h2> Character Info <h2>
          <code>
            <pre id="cinfo">
            </pre>
          </code>
    </div>
    <script type="text/javascript">
      var pkg = undefined;
      var content = undefined;
      var uiElements = ["upload","example","downloadInput","dupeFile"]
      function disableUI(v) {
          v = v?true:false;
          [...(document.getElementById("ui").children)].forEach( elm => {
              if (v) {
                  elm.classList.add("disabled");
              } else {
                  elm.classList.remove("disabled");
              }
          });
          // uiElements.forEach( id => document.getElementById(id).disabled = value );
      }
      function disableNeedFile(v) {
          v = v?true:false;
          [...(document.getElementsByClassName("needFile"))].forEach( elm => {
              if (v) {
                  elm.classList.add("disabled");
              } else {
                  elm.classList.remove("disabled");
              }
          });
      }
      function status(x) {
          document.getElementById("status").innerText = x;
      }
      function installListeners() {
          document.getElementById("upload").onchange = function(e) {
              const file = e.target.files[0];
              console.log(file);
              loadFile(file);
          }
      }
      function characterInfo() {
          document.getElementById("cinfo").innerText = pkg.character_info();
      }
      function logOutput(text) {
          document.getElementById("output").innerText = text;
      }
      function loadExample() {
          if (pkg === undefined) {
              status("File not loaded yet");
              return;
          }
          status("Loading Example!");
          pkg.load_example().then( res => {
              status("TTWLSave loaded: " + res);
              characterInfo();
              disableNeedFile(false);
          });
      }
      function loadFile(file) {
          // josephernest https://github.com/pyodide/pyodide/issues/679#issuecomment-637519913
          var reader = new FileReader();
          reader.readAsArrayBuffer(file);
          reader.onload = evt => { 
              content = evt.target.result; 
              status("Bytes written: "+pkg.load_file_from_browser());
              characterInfo();
              disableNeedFile(false);
          }          
      }
      function downloadInputFile(filename) {
          var array = pkg.get_input_file();
          downloadArray(array,filename);
      }
      function downloadOutputFile() {
          var array = pkg.get_output_file();
          var filename = "ttwl-"+pkg.get_guid()+".sav";
          downloadArray(array,filename);
      }
      function downloadArray(array,filename) {
          var blob = new Blob([array], {type: 'application/octet-stream'});
          var url = window.URL.createObjectURL(blob);
          // This part is dumb, why javascript do I have to do this?
          var anchor = window.document.createElement('a');
          anchor.href = url;
          anchor.download = filename?filename:"output.sav";
          document.body.appendChild(anchor);
          anchor.click();
          document.body.removeChild(anchor);          
      }
      function randomizeGUID() {
          disableUI(true);          
          status("Randomizing the GUID");
          var newGUID = pkg.randomize_guid();
          status("New GUID: "+newGUID);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);
      }
      function unfinishMissions() {
          disableUI(true);
          status("Randomizing the GUID");
          var newGUID = pkg.unfinish_missions();
          status("Unfinished Missions and New GUID: "+newGUID);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);
      }
      function fakeTVHM() {
          disableUI(true);
          status("Randomizing the GUID");
          var newGUID = pkg.fake_tvhm();
          status("Fake TVHM New GUID: "+newGUID);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);
      }
      function chaotic() {
          disableUI(true);
          status("Turning Weapons Chaotic")
          var newGUID = pkg.chaotic();
          status("New GUID: "+newGUID);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);
      }
      function volatile() {
          disableUI(true);
          status("Turning Weapons Volatile")
          var newGUID = pkg.volatile();
          status("New GUID: "+newGUID);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);
      }
      function primordial() {
          disableUI(true);
          status("Turning Weapons Volatile")
          var newGUID = pkg.volatile();
          status("New GUID: "+newGUID);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);
      }

      function importInventory() {
          disableUI(true);
          status("Importing Items");
          var items = document.getElementById("inventory").value;
          var out = pkg.import_items( items );
          outText = out[0];
          newGUID = out[1];
          logOutput(outText);
          characterInfo();
          // downloadOutputFile();
          downloadInputFile("ttwl-"+newGUID+".sav");
          disableUI(false);              
      }

      async function main(){
          let pyodide = await loadPyodide();
          await pyodide.loadPackage(["micropip"]);
          console.log(pyodide.runPython("\" \".join([\"Hello\",\"World\"])"));
          await pyodide.runPythonAsync(`
    from pyodide.http import pyfetch
    response = await pyfetch("./script.py")
    with open("script.py", "wb") as f:
        f.write(await response.bytes())
`
                                      )          
          status("Loading python");
          pkg = pyodide.pyimport("script");
          status("Installing Python modules");
          await pkg.install_deps();
          status("Python Modules Installed: READY TO GO!");
          disableUI(false);
      }
      disableUI(true);
      window.addEventListener("load", 
                              function() {
                                  disableUI(true);
                                  installListeners();
                                  main().then( () => {
                                               disableUI(false);
                                               disableNeedFile(true);
                                  })
                              }, false);
                              
    </script>
  </body>
</html>
